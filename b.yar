import "pe"

rule b_Stage2
 {
	
     strings:
	 	// d'abord flag tout ce qui est HttpRequest et BitMap
		 $a = "BitBlt"
		 $b = "CreateCompatibleBitmap"
		 $c = "CreateCompatibleDC"
		 $d = "GetBitmapBits"
		 $e = "DeleteDC"
		 $f = "WinHttpConnect"
		 $g = "WinHttpOpenRequest"
		 $h = "WinHttpSendRequest"
		 $k = "WinHttpCloseHandle"

		 // flag un pass present dans les string	
		 $pwd = "C:\\Users\\Nofix\\source\\repos\\exam_stage2\\x64\\Release\\exam_stage2.pdb"

		// Ca c'est suspect de fou mais pas suffisant
		 $ker = "USER32.dll" nocase
		 $user = "KERNEL32.dll" nocase
		 $win = "WINHTTP.dll" nocase
		 $gdi = "GDI32.dll" nocase
		         
     condition:
        all of them and pe.is_pe and filesize < 2MB
 }